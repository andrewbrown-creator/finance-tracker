<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div id="app" class="p-3 sm:p-6">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="mb-4 sm:mb-8">
                <h1 class="text-2xl sm:text-4xl font-bold text-slate-800 flex items-center gap-2 sm:gap-3">
                    <svg class="text-green-600" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    <span class="leading-tight">Finance Tracker</span>
                </h1>
            </div>

            <!-- Navigation Tabs -->
            <div class="bg-white rounded-xl shadow-lg p-2 mb-4 sm:mb-6 flex gap-2 overflow-x-auto">
                <button onclick="showTab('monthly')" id="tabMonthly" class="flex-1 whitespace-nowrap py-2 px-4 rounded-lg font-semibold transition-colors bg-blue-500 text-white">
                    Monthly Budget
                </button>
                <button onclick="showTab('debt')" id="tabDebt" class="flex-1 whitespace-nowrap py-2 px-4 rounded-lg font-semibold transition-colors bg-slate-100 text-slate-600 hover:bg-slate-200">
                    Debt Tracker
                </button>
            </div>

            <!-- Monthly Budget Tab -->
            <div id="monthlyTab">
                <!-- Income Section -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-green-500">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-3 sm:mb-4 flex items-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                        Monthly Income
                    </h2>
                    <div class="flex items-center gap-2">
                        <span class="text-slate-600 text-xl sm:text-2xl">£</span>
                        <input type="number" id="income" value="3000" class="text-2xl sm:text-3xl font-bold text-green-600 border-b-2 border-green-200 focus:border-green-500 outline-none px-2 py-1 w-full max-w-xs">
                    </div>
                </div>

                <!-- Expenses Section -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-red-500">
                    <div class="flex justify-between items-center mb-3 sm:mb-4">
                        <h2 class="text-lg sm:text-xl font-semibold text-slate-700 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-red-600">
                                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
                                <polyline points="17 18 23 18 23 12"></polyline>
                            </svg>
                            Direct Expenses
                        </h2>
                        <div class="flex gap-2">
                            <button onclick="addExpense()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg flex items-center gap-1 text-sm transition-colors">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                <span class="hidden sm:inline">Add</span>
                            </button>
                            <button onclick="toggleExpenses()" class="sm:hidden bg-slate-200 hover:bg-slate-300 p-2 rounded-lg transition-colors">
                                <svg id="menuIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="3" y1="12" x2="21" y2="12"></line>
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <line x1="3" y1="18" x2="21" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div id="expensesList" class="space-y-2"></div>
                    
                    <div class="mt-4 pt-4 border-t-2 border-slate-200">
                        <div class="flex justify-between items-center text-base sm:text-lg font-bold">
                            <span class="text-slate-700">Total Expenses:</span>
                            <span class="text-red-600" id="totalExpenses">£0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Bills Section -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-amber-500">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-3 sm:mb-4 flex items-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-amber-600">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Upcoming Bills (Next 7 Days)
                    </h2>
                    <div id="upcomingBills" class="space-y-2">
                        <p class="text-slate-500 text-sm">No bills due in the next 7 days</p>
                    </div>
                </div>

                <!-- Monzo Section -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-purple-500">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-2 sm:mb-4">
                        Monzo (Spending)
                    </h2>
                    <p class="text-xs sm:text-sm text-slate-500 mb-3">Shopping, Petrol, Haircourt, General</p>
                    <div class="flex items-center gap-2">
                        <span class="text-slate-600 text-xl sm:text-2xl">£</span>
                        <input type="number" id="monzo" value="800" class="text-xl sm:text-2xl font-bold text-purple-600 border-b-2 border-purple-200 focus:border-purple-500 outline-none px-2 py-1 w-full max-w-xs">
                    </div>
                </div>

                <!-- Daughter's Savings Section -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-pink-500">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-2 sm:mb-4">
                        Daughter's Savings
                    </h2>
                    <div class="flex items-center gap-2">
                        <span class="text-slate-600 text-xl sm:text-2xl">£</span>
                        <input type="number" id="savings" value="100" class="text-xl sm:text-2xl font-bold text-pink-600 border-b-2 border-pink-200 focus:border-pink-500 outline-none px-2 py-1 w-full max-w-xs">
                    </div>
                </div>

                <!-- Summary Section -->
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-4 sm:p-6 text-white">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6">Summary</h2>
                    <div class="space-y-3 sm:space-y-4">
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-lg p-3">
                            <span class="text-sm sm:text-base">Monthly Income:</span>
                            <span class="font-bold text-lg sm:text-xl" id="summaryIncome">£3000.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-lg p-3">
                            <span class="text-sm sm:text-base">Direct Expenses:</span>
                            <span class="font-bold text-lg sm:text-xl" id="summaryExpenses">-£435.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-lg p-3">
                            <span class="text-sm sm:text-base">To Monzo:</span>
                            <span class="font-bold text-lg sm:text-xl" id="summaryMonzo">-£800.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-lg p-3">
                            <span class="text-sm sm:text-base">Daughter's Savings:</span>
                            <span class="font-bold text-lg sm:text-xl" id="summarySavings">-£100.00</span>
                        </div>
                        
                        <div class="bg-white text-blue-600 rounded-xl p-4 sm:p-6 mt-4 text-center">
                            <p class="text-xs sm:text-sm font-semibold mb-2">Halifax (Billing Account)</p>
                            <p class="text-3xl sm:text-5xl font-bold" id="halifaxRemaining">£1665.00</p>
                            <p id="warningMessage" class="text-red-500 text-sm mt-2 font-semibold hidden">⚠️ Overallocated!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debt Tracker Tab -->
            <div id="debtTab" class="hidden">
                <!-- Total Savings Section -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-green-500">
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-green-500">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-3 sm:mb-4 flex items-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                            <line x1="1" y1="10" x2="23" y2="10"></line>
                        </svg>
                        Total Savings
                    </h2>
                    <div class="flex items-center gap-2">
                        <span class="text-slate-600 text-xl sm:text-2xl">£</span>
                        <input type="number" id="totalSavings" value="5000" class="text-2xl sm:text-3xl font-bold text-green-600 border-b-2 border-green-200 focus:border-green-500 outline-none px-2 py-1 w-full max-w-xs">
                    </div>
                </div>

                <!-- Debts Section -->
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-orange-500">
                    <div class="flex justify-between items-center mb-3 sm:mb-4">
                        <h2 class="text-lg sm:text-xl font-semibold text-slate-700 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-orange-600">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                            Outstanding Debts
                        </h2>
                        <button onclick="addDebt()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg flex items-center gap-1 text-sm transition-colors">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <span class="hidden sm:inline">Add</span>
                        </button>
                    </div>
                    
                    <div id="debtsList" class="space-y-2"></div>
                    
                    <div class="mt-4 pt-4 border-t-2 border-slate-200">
                        <div class="flex justify-between items-center text-base sm:text-lg font-bold">
                            <span class="text-slate-700">Total Debt:</span>
                            <span class="text-orange-600" id="totalDebt">£0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Net Position Section -->
                <div class="bg-gradient-to-r from-slate-700 to-slate-800 rounded-xl shadow-lg p-4 sm:p-6 text-white">
                    <h2 class="text-xl sm:text-2xl font-bold mb-6">Net Position</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center bg-white bg-opacity-10 rounded-lg p-3">
                            <span class="text-sm sm:text-base">Total Savings:</span>
                            <span class="font-bold text-lg sm:text-xl text-green-400" id="netSavings">£5000.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-10 rounded-lg p-3">
                            <span class="text-sm sm:text-base">Total Debt:</span>
                            <span class="font-bold text-lg sm:text-xl text-orange-400" id="netDebt">-£0.00</span>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 sm:p-6 mt-4 text-center">
                            <p class="text-xs sm:text-sm font-semibold mb-2 text-slate-600">Your Net Position</p>
                            <p class="text-4xl sm:text-6xl font-bold mb-2" id="netPosition">£5000.00</p>
                            <div id="statusBadge" class="inline-block px-4 py-2 rounded-full text-sm font-bold">
                                ✓ IN THE BLACK
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payoff Plan Tab -->
            <div id="payoffTab" class="hidden">
                <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 border-t-4 border-indigo-500">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-4 flex items-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-indigo-600">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                        Debt Payoff Calculator
                    </h2>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Monthly Extra Payment Available</label>
                        <div class="flex items-center gap-2">
                            <span class="text-slate-600">£</span>
                            <input type="number" id="extraPayment" value="200" class="text-xl font-bold text-indigo-600 border-b-2 border-indigo-200 focus:border-indigo-500 outline-none px-2 py-1 w-full max-w-xs">
                        </div>
                        <p class="text-xs text-slate-500 mt-2">Amount you can put towards debt each month (after minimum payments)</p>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Payoff Strategy</label>
                        <select id="payoffStrategy" class="w-full max-w-xs px-3 py-2 border border-slate-200 rounded-lg focus:border-indigo-400 outline-none">
                            <option value="avalanche">Avalanche (Highest Interest First)</option>
                            <option value="snowball">Snowball (Lowest Balance First)</option>
                        </select>
                        <p class="text-xs text-slate-500 mt-2" id="strategyDescription">Pay off highest interest debts first to save money</p>
                    </div>

                    <button onclick="calculatePayoff()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors mb-4">
                        Calculate Payoff Plan
                    </button>

                    <div id="payoffResults" class="hidden">
                        <div class="bg-indigo-50 rounded-lg p-4 mb-4">
                            <div class="text-center mb-4">
                                <p class="text-sm text-slate-600 mb-1">Debt-Free Date</p>
                                <p class="text-3xl font-bold text-indigo-600" id="debtFreeDate">--</p>
                                <p class="text-sm text-slate-600 mt-1">(<span id="monthsToPayoff">--</span> months)</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div>
                                    <p class="text-xs text-slate-600">Total Interest</p>
                                    <p class="text-xl font-bold text-orange-600" id="totalInterest">£0</p>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-600">Total Paid</p>
                                    <p class="text-xl font-bold text-slate-700" id="totalPaid">£0</p>
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-semibold text-slate-700 mb-3">Payoff Order</h3>
                        <div id="payoffOrder" class="space-y-3"></div>
                    </div>

                    <div id="noDebtsMessage" class="hidden text-center py-8 text-slate-500">
                        <p>No debts to pay off! Add debts in the Debt Tracker tab.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data structures
        let expenses = [
            { id: 1, name: 'Energy', amount: 150, dueDate: '' },
            { id: 2, name: 'Sky Television', amount: 65, dueDate: '' },
            { id: 3, name: 'Sky Mobile', amount: 25, dueDate: '' },
            { id: 4, name: 'Giffgaff', amount: 10, dueDate: '' },
            { id: 5, name: 'Council Tax', amount: 120, dueDate: '' },
            { id: 6, name: 'Water', amount: 35, dueDate: '' },
            { id: 7, name: 'Internet', amount: 30, dueDate: '' }
        ];
        let nextExpenseId = 8;

        let debts = [
            { id: 1, name: 'Credit Card', amount: 1500 },
            { id: 2, name: 'Leyla', amount: 800 },
            { id: 3, name: 'Very', amount: 450 },
            { id: 4, name: 'Monzo Flex', amount: 320 }
        ];
        let nextDebtId = 5;

        let expensesVisible = true;

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('financeTrackerData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.expenses) expenses = data.expenses;
                    if (data.debts) debts = data.debts;
                    if (data.nextExpenseId) nextExpenseId = data.nextExpenseId;
                    if (data.nextDebtId) nextDebtId = data.nextDebtId;
                    if (data.income) document.getElementById('income').value = data.income;
                    if (data.monzo) document.getElementById('monzo').value = data.monzo;
                    if (data.savings) document.getElementById('savings').value = data.savings;
                    if (data.totalSavings) document.getElementById('totalSavings').value = data.totalSavings;
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
        }

        // Save data to localStorage
        function saveData() {
            const data = {
                expenses,
                debts,
                nextExpenseId,
                nextDebtId,
                income: parseFloat(document.getElementById('income').value) || 0,
                monzo: parseFloat(document.getElementById('monzo').value) || 0,
                savings: parseFloat(document.getElementById('savings').value) || 0,
                totalSavings: parseFloat(document.getElementById('totalSavings').value) || 0
            };
            localStorage.setItem('financeTrackerData', JSON.stringify(data));
        }

        function showTab(tab) {
            const monthlyTab = document.getElementById('monthlyTab');
            const debtTab = document.getElementById('debtTab');
            const btnMonthly = document.getElementById('tabMonthly');
            const btnDebt = document.getElementById('tabDebt');

            monthlyTab.classList.add('hidden');
            debtTab.classList.add('hidden');
            
            btnMonthly.className = 'flex-1 whitespace-nowrap py-2 px-4 rounded-lg font-semibold transition-colors bg-slate-100 text-slate-600 hover:bg-slate-200';
            btnDebt.className = 'flex-1 whitespace-nowrap py-2 px-4 rounded-lg font-semibold transition-colors bg-slate-100 text-slate-600 hover:bg-slate-200';

            if (tab === 'monthly') {
                monthlyTab.classList.remove('hidden');
                btnMonthly.className = 'flex-1 whitespace-nowrap py-2 px-4 rounded-lg font-semibold transition-colors bg-blue-500 text-white';
                updateUpcomingBills();
            } else if (tab === 'debt') {
                debtTab.classList.remove('hidden');
                btnDebt.className = 'flex-1 whitespace-nowrap py-2 px-4 rounded-lg font-semibold transition-colors bg-blue-500 text-white';
                updateDebtSummary();
            }
        }

        function renderExpenses() {
            const container = document.getElementById('expensesList');
            container.innerHTML = '';
            container.className = expensesVisible ? 'space-y-2' : 'space-y-2 hidden sm:block';
            
            expenses.forEach(exp => {
                const div = document.createElement('div');
                div.className = 'flex flex-col sm:flex-row items-stretch sm:items-center gap-2 bg-slate-50 p-3 rounded-lg';
                div.innerHTML = `
                    <input type="text" value="${exp.name}" onchange="updateExpenseName(${exp.id}, this.value)" 
                           class="flex-1 px-3 py-2 border border-slate-200 rounded focus:border-blue-400 outline-none text-base">
                    <div class="flex items-center gap-2">
                        <span class="text-slate-600">£</span>
                        <input type="number" value="${exp.amount}" onchange="updateExpenseAmount(${exp.id}, this.value)"
                               class="w-24 px-3 py-2 border border-slate-200 rounded focus:border-blue-400 outline-none text-right text-base">
                        <input type="date" value="${exp.dueDate || ''}" onchange="updateExpenseDueDate(${exp.id}, this.value)"
                               class="w-36 px-2 py-2 border border-slate-200 rounded focus:border-blue-400 outline-none text-sm"
                               placeholder="Due date">
                        <button onclick="deleteExpense(${exp.id})" class="text-red-500 hover:bg-red-50 p-2 rounded transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
            updateSummary();
            updateUpcomingBills();
        }

        function renderDebts() {
            const container = document.getElementById('debtsList');
            container.innerHTML = '';
            
            debts.forEach(debt => {
                const div = document.createElement('div');
                div.className = 'flex flex-col sm:flex-row items-stretch sm:items-center gap-2 bg-slate-50 p-3 rounded-lg';
                div.innerHTML = `
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                        <input type="text" value="${debt.name}" onchange="updateDebtName(${debt.id}, this.value)" 
                               class="flex-1 px-3 py-2 border border-slate-200 rounded focus:border-blue-400 outline-none text-base">
                        <div class="flex items-center gap-2">
                            <span class="text-slate-600">£</span>
                            <input type="number" value="${debt.amount}" onchange="updateDebtAmount(${debt.id}, this.value)"
                                   class="flex-1 sm:w-24 px-3 py-2 border border-slate-200 rounded focus:border-blue-400 outline-none text-right text-base">
                            <button onclick="deleteDebt(${debt.id})" class="text-red-500 hover:bg-red-50 p-2 rounded transition-colors">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
            updateDebtSummary();
        }

        function updateUpcomingBills() {
            const container = document.getElementById('upcomingBills');
            const today = new Date();
            const sevenDaysFromNow = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const upcoming = expenses.filter(exp => {
                if (!exp.dueDate) return false;
                const dueDate = new Date(exp.dueDate);
                return dueDate >= today && dueDate <= sevenDaysFromNow;
            }).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

            if (upcoming.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-sm">No bills due in the next 7 days</p>';
                return;
            }

            container.innerHTML = upcoming.map(exp => {
                const dueDate = new Date(exp.dueDate);
                const daysUntil = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                const urgency = daysUntil <= 2 ? 'bg-red-50 border-red-200' : 'bg-amber-50 border-amber-200';
                
                return `
                    <div class="flex justify-between items-center p-3 rounded-lg border ${urgency}">
                        <div>
                            <p class="font-semibold text-slate-700">${exp.name}</p>
                            <p class="text-xs text-slate-500">Due ${dueDate.toLocaleDateString('en-GB')}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-slate-700">£${exp.amount.toFixed(2)}</p>
                            <p class="text-xs ${daysUntil <= 2 ? 'text-red-600' : 'text-amber-600'} font-semibold">
                                ${daysUntil === 0 ? 'Due today!' : daysUntil === 1 ? 'Due tomorrow' : `In ${daysUntil} days`}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function calculatePayoff() {
            const extraPayment = parseFloat(document.getElementById('extraPayment').value) || 0;
            const strategy = document.getElementById('payoffStrategy').value;
            
            if (debts.length === 0) {
                document.getElementById('payoffResults').classList.add('hidden');
                document.getElementById('noDebtsMessage').classList.remove('hidden');
                return;
            }

            document.getElementById('noDebtsMessage').classList.add('hidden');
            
            // Sort debts based on strategy
            let sortedDebts = [...debts];
            if (strategy === 'avalanche') {
                sortedDebts.sort((a, b) => b.interestRate - a.interestRate);
            } else {
                sortedDebts.sort((a, b) => a.amount - b.amount);
            }

            // Calculate payoff timeline
            let workingDebts = sortedDebts.map(d => ({...d}));
            let totalInterest = 0;
            let totalPaid = 0;
            let months = 0;
            const monthlyRate = (debt) => (debt.interestRate / 100) / 12;

            while (workingDebts.some(d => d.amount > 0) && months < 600) { // 50 year max
                months++;
                let remainingExtra = extraPayment;

                for (let debt of workingDebts) {
                    if (debt.amount <= 0) continue;

                    const interest = debt.amount * monthlyRate(debt);
                    totalInterest += interest;
                    
                    const minPayment = Math.min(debt.minimumPayment, debt.amount + interest);
                    let payment = minPayment;

                    if (debt === workingDebts.find(d => d.amount > 0)) {
                        payment += Math.min(remainingExtra, debt.amount + interest - minPayment);
                        remainingExtra = Math.max(0, remainingExtra - (payment - minPayment));
                    }

                    debt.amount = Math.max(0, debt.amount + interest - payment);
                    totalPaid += payment;
                }
            }

            const debtFreeDate = new Date();
            debtFreeDate.setMonth(debtFreeDate.getMonth() + months);

            document.getElementById('debtFreeDate').textContent = debtFreeDate.toLocaleDateString('en-GB', { month: 'long', year: 'numeric' });
            document.getElementById('monthsToPayoff').textContent = months;
            document.getElementById('totalInterest').textContent = `£${totalInterest.toFixed(0)}`;
            document.getElementById('totalPaid').textContent = `£${totalPaid.toFixed(0)}`;

            const orderContainer = document.getElementById('payoffOrder');
            orderContainer.innerHTML = sortedDebts.map((debt, idx) => `
                <div class="bg-slate-50 p-3 rounded-lg border-l-4 ${idx === 0 ? 'border-indigo-500' : 'border-slate-300'}">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-slate-700">${idx + 1}. ${debt.name}</p>
                            <p class="text-xs text-slate-500">${debt.interestRate}% APR • £${debt.minimumPayment} min payment</p>
                        </div>
                        <p class="font-bold text-slate-700">£${debt.amount.toFixed(2)}</p>
                    </div>
                    ${idx === 0 ? '<p class="text-xs text-indigo-600 font-semibold mt-1">↑ Focus here first</p>' : ''}
                </div>
            `).join('');

            document.getElementById('payoffResults').classList.remove('hidden');
        }

        function addExpense() {
            expenses.push({ id: nextExpenseId++, name: 'New Expense', amount: 0, dueDate: '' });
            renderExpenses();
            saveData();
        }

        function addDebt() {
            debts.push({ id: nextDebtId++, name: 'New Debt', amount: 0 });
            renderDebts();
            saveData();
        }

        function updateExpenseName(id, value) {
            const exp = expenses.find(e => e.id === id);
            if (exp) {
                exp.name = value;
                saveData();
            }
        }

        function updateExpenseAmount(id, value) {
            const exp = expenses.find(e => e.id === id);
            if (exp) {
                exp.amount = parseFloat(value) || 0;
                updateSummary();
                saveData();
            }
        }

        function updateExpenseDueDate(id, value) {
            const exp = expenses.find(e => e.id === id);
            if (exp) {
                exp.dueDate = value;
                updateUpcomingBills();
                saveData();
            }
        }

        function deleteExpense(id) {
            expenses = expenses.filter(e => e.id !== id);
            renderExpenses();
            saveData();
        }

        function updateDebtName(id, value) {
            const debt = debts.find(d => d.id === id);
            if (debt) {
                debt.name = value;
                saveData();
            }
        }

        function updateDebtAmount(id, value) {
            const debt = debts.find(d => d.id === id);
            if (debt) {
                debt.amount = parseFloat(value) || 0;
                updateDebtSummary();
                saveData();
            }
        }

        function deleteDebt(id) {
            debts = debts.filter(d => d.id !== id);
            renderDebts();
            saveData();
        }

        function toggleExpenses() {
            expensesVisible = !expensesVisible;
            renderExpenses();
        }

        function updateSummary() {
            const income = parseFloat(document.getElementById('income').value) || 0;
            const monzo = parseFloat(document.getElementById('monzo').value) || 0;
            const savings = parseFloat(document.getElementById('savings').value) || 0;
            const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const halifax = income - totalExpenses - monzo - savings;

            document.getElementById('totalExpenses').textContent = `£${totalExpenses.toFixed(2)}`;
            document.getElementById('summaryIncome').textContent = `£${income.toFixed(2)}`;
            document.getElementById('summaryExpenses').textContent = `-£${totalExpenses.toFixed(2)}`;
            document.getElementById('summaryMonzo').textContent = `-£${monzo.toFixed(2)}`;
            document.getElementById('summarySavings').textContent = `-£${savings.toFixed(2)}`;
            
            const halifaxEl = document.getElementById('halifaxRemaining');
            halifaxEl.textContent = `£${halifax.toFixed(2)}`;
            halifaxEl.className = halifax >= 0 ? 'text-3xl sm:text-5xl font-bold text-black' : 'text-3xl sm:text-5xl font-bold text-red-600';
            
            const warning = document.getElementById('warningMessage');
            warning.className = halifax < 0 ? 'text-red-500 text-sm mt-2 font-semibold' : 'text-red-500 text-sm mt-2 font-semibold hidden';
            
            saveData();
        }

        function updateDebtSummary() {
            const totalSavings = parseFloat(document.getElementById('totalSavings').value) || 0;
            const totalDebtAmount = debts.reduce((sum, debt) => sum + debt.amount, 0);
            const netPos = totalSavings - totalDebtAmount;

            document.getElementById('totalDebt').textContent = `£${totalDebtAmount.toFixed(2)}`;
            document.getElementById('netSavings').textContent = `£${totalSavings.toFixed(2)}`;
            document.getElementById('netDebt').textContent = `-£${totalDebtAmount.toFixed(2)}`;
            
            const netPosEl = document.getElementById('netPosition');
            const statusBadge = document.getElementById('statusBadge');
            
            netPosEl.textContent = `£${netPos.toFixed(2)}`;
            
            if (netPos >= 0) {
                netPosEl.className = 'text-4xl sm:text-6xl font-bold mb-2 text-black';
                statusBadge.className = 'inline-block px-4 py-2 rounded-full text-sm font-bold bg-slate-100 text-slate-700';
                statusBadge.textContent = '✓ IN THE BLACK';
            } else {
                netPosEl.className = 'text-4xl sm:text-6xl font-bold mb-2 text-red-600';
                statusBadge.className = 'inline-block px-4 py-2 rounded-full text-sm font-bold bg-red-100 text-red-700';
                statusBadge.textContent = '⚠ IN THE RED';
            }
            
            saveData();
        }

        // Event listeners
        document.getElementById('income').addEventListener('input', updateSummary);
        document.getElementById('monzo').addEventListener('input', updateSummary);
        document.getElementById('savings').addEventListener('input', updateSummary);
        document.getElementById('totalSavings').addEventListener('input', updateDebtSummary);

        // Initialize
        loadData();
        renderExpenses();
        renderDebts();
    </script>
</body>
</html>
